{% extends "base.html" %}

{% block title %}Tour Packages - TourBook{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-map-marked-alt"></i> Explore Tour Packages</h2>
    <div>
        <form class="d-flex" method="GET">
            <input type="text" class="form-control me-2" name="search" placeholder="Search packages..." value="{{ request.args.get('search', '') }}">
            <select class="form-select me-2" name="category">
                <option value="">All Categories</option>
                <option value="Beach" {% if request.args.get('category') == 'Beach' %}selected{% endif %}>Beach</option>
                <option value="Adventure" {% if request.args.get('category') == 'Adventure' %}selected{% endif %}>Adventure</option>
                <option value="Cultural" {% if request.args.get('category') == 'Cultural' %}selected{% endif %}>Cultural</option>
                <option value="Wildlife" {% if request.args.get('category') == 'Wildlife' %}selected{% endif %}>Wildlife</option>
                <option value="Relaxation" {% if request.args.get('category') == 'Relaxation' %}selected{% endif %}>Relaxation</option>
                <option value="Nature" {% if request.args.get('category') == 'Nature' %}selected{% endif %}>Nature</option>
                <option value="Luxury" {% if request.args.get('category') == 'Luxury' %}selected{% endif %}>Luxury</option>
            </select>
            <select class="form-select me-2" name="sort">
                <option value="name">Sort by Name</option>
                <option value="price_low" {% if request.args.get('sort') == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                <option value="price_high" {% if request.args.get('sort') == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                <option value="duration" {% if request.args.get('sort') == 'duration' %}selected{% endif %}>Duration</option>
            </select>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
</div>

<!-- Package Statistics -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <h3 class="text-primary mb-0">{{ packages|length }}</h3>
                <p class="text-muted mb-0">Total Packages</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <h3 class="text-success mb-0">{{ packages|selectattr('available_slots', 'gt', 0)|list|length }}</h3>
                <p class="text-muted mb-0">Available</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <h3 class="text-warning mb-0">{{ packages|selectattr('available_slots', 'eq', 0)|list|length }}</h3>
                <p class="text-muted mb-0">Fully Booked</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <h3 class="text-info mb-0">{{ (packages|map(attribute='price')|max)|default(0) }}</h3>
                <p class="text-muted mb-0">Highest Price</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    {% for package in packages %}
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card package-card h-100">
            <div class="package-image position-relative" 
                 style="background-image: url('{{ package.image_url }}'); height: 250px; background-size: cover; background-position: center;">
                <div class="position-absolute top-0 end-0 m-2">
                    <span class="badge bg-{{ 'success' if package.available_slots > 5 else 'warning' if package.available_slots > 0 else 'danger' }}">
                        {{ package.available_slots }} slots
                    </span>
                </div>
                <div class="position-absolute top-0 start-0 m-2">
                    <span class="badge bg-secondary">{{ package.category }}</span>
                </div>
                <div class="position-absolute bottom-0 start-0 w-100 p-3" 
                     style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                    <h5 class="text-white mb-1">{{ package.name }}</h5>
                    <small class="text-light">
                        <i class="fas fa-map-marker-alt"></i> {{ package.destination }}
                        • {{ package.duration_days }} days
                    </small>
                </div>
            </div>
            <div class="card-body">
                <p class="card-text text-muted">{{ package.description[:120] }}...</p>
                
                <div class="package-features mb-3">
                    <small class="text-muted">
                        <i class="fas fa-hotel text-primary"></i> Accommodation • 
                        <i class="fas fa-utensils text-success"></i> Meals • 
                        <i class="fas fa-bus text-warning"></i> Transport
                    </small>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="text-primary mb-0">₹{{ package.price }}</h4>
                        <small class="text-muted">per person</small>
                    </div>
                    <div class="rating">
                        {% set avg_rating = range(4, 6)|random %}
                        {% for i in range(1, 6) %}
                        <i class="fas fa-star{{ ' text-warning' if i <= avg_rating else ' text-muted' }}"></i>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('package_detail', package_id=package.id) }}" class="btn btn-outline-primary">
                        <i class="fas fa-info-circle"></i> View Details
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h4>No Packages Found</h4>
                <p class="text-muted">Try adjusting your search criteria or browse all categories.</p>
                <a href="{{ url_for('packages') }}" class="btn btn-primary">Show All Packages</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Categories Quick Links -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Browse by Category</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Beach" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-umbrella-beach fa-2x text-primary mb-2"></i>
                                <p class="mb-0">Beach</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Adventure" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-hiking fa-2x text-success mb-2"></i>
                                <p class="mb-0">Adventure</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Cultural" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-landmark fa-2x text-warning mb-2"></i>
                                <p class="mb-0">Cultural</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Wildlife" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-paw fa-2x text-danger mb-2"></i>
                                <p class="mb-0">Wildlife</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Nature" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-tree fa-2x text-success mb-2"></i>
                                <p class="mb-0">Nature</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-2 mb-3">
                        <a href="{{ url_for('packages') }}?category=Luxury" class="text-decoration-none">
                            <div class="category-icon">
                                <i class="fas fa-crown fa-2x text-warning mb-2"></i>
                                <p class="mb-0">Luxury</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- In packages.html, update the package cards section -->
<div class="row">
    {% for package in packages %}
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100 package-card">
            <img src="{{ package.image_url }}" 
                 class="card-img-top package-image" 
                 alt="{{ package.name }}"
                 onerror="this.src='https://via.placeholder.com/400x300/007bff/ffffff?text=Tour+Package'"
                 style="height: 250px; object-fit: cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ package.name }}</h5>
                <p class="card-text text-muted">
                    <i class="fas fa-map-marker-alt me-2"></i>{{ package.destination }}
                </p>
                <p class="card-text flex-grow-1">{{ package.description[:100] }}{% if package.description|length > 100 %}...{% endif %}</p>
                
                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="badge bg-primary">{{ package.category }}</span>
                        <span class="text-muted">
                            <i class="fas fa-clock me-1"></i>{{ package.duration_days }} days
                        </span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="text-success mb-0">₹{{ "%.2f"|format(package.price) }}</h5>
                        <span class="text-muted">
                            <i class="fas fa-users me-1"></i>{{ package.available_slots }} slots
                        </span>
                    </div>
                    
                    <a href="{{ url_for('package_detail', package_id=package.id) }}" 
                       class="btn btn-primary w-100 mt-3">
                        <i class="fas fa-eye me-2"></i>View Details
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
        <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">No packages found</h4>
        <p class="text-muted">Try adjusting your search or filter criteria.</p>
        <a href="{{ url_for('packages') }}" class="btn btn-primary">
            <i class="fas fa-refresh me-2"></i>Show All Packages
        </a>
    </div>
    {% endfor %}
</div>
{% endblock %}

<style>
.package-card {
    border: none;
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.package-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.package-image {
    transition: transform 0.3s ease;
}

.package-card:hover .package-image {
    transform: scale(1.05);
}

.category-icon {
    transition: all 0.3s ease;
    padding: 15px;
    border-radius: 10px;
}

.category-icon:hover {
    background-color: #f8f9fa;
    transform: translateY(-2px);
}

.stat-card {
    border-left: 4px solid;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
}
</style>